# 1.控制流程函数

- `CASE value WHEN [compare-value] THEN result [WHEN [compare-value] THEN result ...] [ELSE result] END`

`CASE WHEN [condition] THEN result [WHEN [condition] THEN result ...] [ELSE result] END`

在上面第一条语句返回的是`value=compare-value`的结果。而第二条语句的返回结果是第一条语句的真正的结果。如果没有匹配的结果值，则返回结果为`ELSE`语句后的结果，如果没有`ELSE`部分，则返回值为`NULL`。
```
mysql> SELECT CASE 1 WHEN 1 THEN 'one'
    -> WHEN 2 THEN 'two' ELSE 'more' END;
+------------------------------------------------------------+
| CASE 1 WHEN 1 THEN 'one'
WHEN 2 THEN 'two' ELSE 'more' END |
+------------------------------------------------------------+
| one                                                        |
+------------------------------------------------------------+
1 row in set (0.00 sec)

mysql> SELECT CASE WHEN 1>0 THEN 'true' ELSE 'false' END;
+--------------------------------------------+
| CASE WHEN 1>0 THEN 'true' ELSE 'false' END |
+--------------------------------------------+
| true                                       |
+--------------------------------------------+
1 row in set (0.00 sec)


mysql> SELECT CASE BINARY 'B'
    -> WHEN 'a' THEN 1 WHEN 'b' THEN 2 END;
+-----------------------------------------------------+
| CASE BINARY 'B'
WHEN 'a' THEN 1 WHEN 'b' THEN 2 END |
+-----------------------------------------------------+
|                                                NULL |
+-----------------------------------------------------+
1 row in set (0.03 sec)

```
一个`CASE`表达式的默认返回值类型是任何返回值的兼容类型，但具体情况视其所在语境而定。如果用在字符串语境中，则返回结果为字符串类型。如果用在数字语境中，则返回结果为十进制值、实数值或整数值。

- `IF(expr1,expr2,expr3)`

如果`expr1`是`TRUE(expr1 <> 0 and expr1 <> NULL)`，则`IF()`的返回值为`expr2`; 否则返回值则为`expr3`。`IF()`的返回值是否为数字值或字符串值，具体情况视其所在语境而定。
```
mysql> SELECT IF(1>2,2,3);
+-------------+
| IF(1>2,2,3) |
+-------------+
|           3 |
+-------------+
1 row in set (0.01 sec)

mysql> SELECT IF(1<2,'yes ','no');
+---------------------+
| IF(1<2,'yes ','no') |
+---------------------+
| yes                 |
+---------------------+
1 row in set (0.00 sec)

mysql> SELECT IF(STRCMP('test','test1'),'no','yes');
+---------------------------------------+
| IF(STRCMP('test','test1'),'no','yes') |
+---------------------------------------+
| no                                    |
+---------------------------------------+
1 row in set (0.00 sec)

```
如果`expr2`或`expr3`中只有一个表达式是`NULL`值，则`IF()`函数的结果类型 为非`NULL`表达式的结果类型。

`expr1`必须作为一个整数值进行评估，也就是说，假如你正在验证浮点值或字符串值，那么应该使用比较运算进行检验。
```
mysql> SELECT IF(0.1,1,0);
+-------------+
| IF(0.1,1,0) |
+-------------+
|           1 |
+-------------+
1 row in set (0.00 sec)

mysql> SELECT IF(0.1<>0,1,0);
+----------------+
| IF(0.1<>0,1,0) |
+----------------+
|              1 |
+----------------+
1 row in set (0.00 sec)

```
观察并对比上述语句的返回结果，发现在上述的第一个例子中，`IF(0.1)`的返回值为`1`，原因是`IF(0.1)`检验为真。在第二个例子中，比较检验了原始浮点值，目的是为了了解是否其为非零值，对比的结果是`0.1`确实不等于`0`，那么第一个表达式的结果就是整数`1`，因此返回结果为`1`。

- `IFNULL(expr1,expr2)`

假如`expr1`不为`NULL`，则`IFNULL()`的返回值为 `expr1`；否则其返回值为`expr2`。`IFNULL()`的返回值是否为数字或是字符串，具体情况取决于其所使用的语境。
```
mysql> SELECT IFNULL(1,0);
+-------------+
| IFNULL(1,0) |
+-------------+
|           1 |
+-------------+
1 row in set (0.00 sec)

mysql> SELECT IFNULL(NULL,10);
+-----------------+
| IFNULL(NULL,10) |
+-----------------+
|              10 |
+-----------------+
1 row in set (0.00 sec)

mysql> SELECT IFNULL(1/0,10);
+----------------+
| IFNULL(1/0,10) |
+----------------+
|        10.0000 |
+----------------+
1 row in set (0.01 sec)

```
`IFNULL(expr1,expr2)`的默认结果值为两个表达式中数据类型更加“通用”的一个，顺序为`STRING`、`REAL`或`INTEGER`。假设有一个表中含有该表达式，或MySQL必须在内存储器中储存`IFNULL()`的返回值到一个临时表中：
```
CREATE TABLE tmp SELECT IFNULL(1,'test') AS test；
DESCRIBE tmp;
```
在这个例子中，测试列的类型为字符串类型`CHAR(4)`。

- `NULLIF(expr1,expr2)`

如果`expr1 = expr2`成立，那么返回值为`NULL`，否则返回值为`expr1`。这和`CASE WHEN expr1 = expr2 THEN NULL ELSE expr1 END`语句的原理相同。
```
mysql> SELECT NULLIF(1,1);
+-------------+
| NULLIF(1,1) |
+-------------+
|        NULL |
+-------------+
1 row in set (0.00 sec)

mysql> SELECT NULLIF(1,2);
+-------------+
| NULLIF(1,2) |
+-------------+
|           1 |
+-------------+
1 row in set (0.00 sec)

```
注意：如果参数不相等，则MySQL会评估`expr1`两次。
