# MySQL 存储过程和函数
# 1.创建存储过程和函数

`CREATE PROCEDURE`和`CREATE FUNCTION`的语法：
```
CREATE PROCEDURE sp_name ([proc_parameter[,...]])
    [characteristic ...] routine_body

CREATE FUNCTION sp_name ([func_parameter[,...]])
    RETURNS type
    [characteristic ...] routine_body

    proc_parameter:
    [ IN | OUT | INOUT ] param_name type

    func_parameter:
    param_name type

type:
    Any valid MySQL data type

characteristic:
    LANGUAGE SQL
  | [NOT] DETERMINISTIC
  | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }
  | SQL SECURITY { DEFINER | INVOKER }
  | COMMENT 'string'

routine_body:
    Valid SQL procedure statement or statements
```
这些语句用于创建并存储子程序。要在`MySQL 5.1`中创建子程序，必须具有`CREATE ROUTINE`权限，并且`ALTER ROUTINE`和`EXECUTE`权限被自动授予它的创建者。

默认情况下，子程序与当前数据库关联。要明确地把子程序与一个给定数据库关联起来，可以在创建子程序的时候指定其名字为`db_name.sp_name`。

如果子程序名和`SQL`内部函数名一样，在定义子程序时，你需要在这个名字和随后括号中间插入一个空格，否则发生语法错误。在你之后调用子程序的时候也要插入。为此，即使有可能出现这种情况，我们还是建议最好避免给你的存储子程序取与已经存在的`SQL`函数一样的名字。

由括号包围的参数列必须总是存在。如果没有参数，也该使用一个空参数列()。每个参数默认都是一个 `IN`（内部）参数。要指定为其它参数，可在参数名之前使用关键词 `OUT`或`INOUT`。

注意： 指定参数为`IN`， `OUT`， 或`INOUT` 只对`PROCEDURE`是合法的。（`FUNCTION`参数总是被认为是`IN`）

下面是一个使用`OUT`参数的简单的存储过程的例子。例子为：在程序被定义的时候，用`mysql`客户端`delimiter`命令来把语句定界符从;变为`//`。这就允许用在程序体中的;定界符被传递到服务器而不是被`mysql`自己来解释。
```
mysql> delimiter //
mysql> CREATE PROCEDURE simpleproc (OUT param1 INT)
    -> BEGIN
    ->   SELECT COUNT(*) INTO param1 FROM t;
    -> END
    -> //
mysql> delimiter ;
mysql> CALL simpleproc(@a);
mysql> SELECT @a;
```
当使用`delimiter`命令时，你应该避免使用反斜杠(`‘\’`)字符，因为那是`MySQL`的转义字符。

下列是一个例子，一个采用参数的函数使用一个`SQL`函数执行一个操作，并返回结果：
```
mysql> delimiter //
mysql> CREATE FUNCTION hello (s CHAR(20)) RETURNS CHAR(50)
    -> RETURN CONCAT('Hello, ',s,'!');
    -> //
mysql> delimiter ;
mysql> SELECT hello('world');
```

如果在存储函数中的`RETURN`语句中返回一个类型不同于在函数的`RETURNS`子句中指定类型的值，返回值被强制转换为相对恰当的类型。比如，如果一个函数返回一个`ENUM`或`SET`值，但是`RETURN`语句返回一个整数，对于`SET`成员集合的相应的`ENUM`成员，从函数返回的值是字符串类型数据。

# 2. 修改存储过程和函数

`ALTER PROCEDURE`和`ALTER FUNCTION` 语法：
```
ALTER {PROCEDURE | FUNCTION} sp_name [characteristic ...]

characteristic:
    { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }
  | SQL SECURITY { DEFINER | INVOKER }
  | COMMENT 'string'
```
这个语句可以被用来改变存储过程或函数的特征。

在`ALTER PROCEDURE`和`ALTER FUNCTION`语句中，可以指定一个以上的改变。

# 3. 删除存储过程和函数

`DROP PROCEDURE`和`DROP FUNCTION` 语法：
```
DROP {PROCEDURE | FUNCTION} [IF EXISTS] sp_name
```
这个语句被用来移除一个存储过程或函数。即从服务器上移除一个制定的子程序。

`IF EXISTS`子句是一个`MySQL`的扩展。它防止如果程序或函数不存在产生的错误，并产生一个可以用`SHOW WARNINGS`查看的警告。

# 4. `SHOW CREATE PROCEDURE`和`SHOW CREATE FUNCTION`

`SHOW CREATE PROCEDURE`和`SHOW CREATE FUNCTION`：
```
SHOW CREATE {PROCEDURE | FUNCTION} sp_name
```
这个语句是一个`MySQL`的扩展。类似于`SHOW CREATE TABLE`，它返回一个可用来重新创建并且已命名的子程序的字符串。

例如以下语句返回`test`数据库内的`hello`程序信息：
```
mysql> SHOW CREATE FUNCTION test.hello\G
```

# 5. `SHOW PROCEDURE STATUS`和`SHOW FUNCTION STATUS`
```
SHOW {PROCEDURE | FUNCTION} STATUS [LIKE 'pattern']
```
这个语句是一个`MySQL`的扩展。它返回子程序的特征，如数据库，名字，类型，创建者及创建和修改日期。如果没有指定样式，根据你使用的语句，所有存储过程和所有存储函数的信息都被列出。

例如：
```
mysql> SHOW FUNCTION STATUS LIKE 'hello'\G

```
